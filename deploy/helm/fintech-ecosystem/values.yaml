# Default values for fintech-ecosystem.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

global:
  environment: "production"

# Secrets (Should be overridden in production)
secrets:
  postgresPassword: "password"
  postgresUser: "user"
  rabbitmqPassword: "password"
  rabbitmqUser: "user"
  apiKeyHmacSecret: "super-secret-pepper-change-me-in-prod"

# Infrastructure
infrastructure:
  enabled: true
  redis:
    image: "redis:7-alpine"
    port: 6379
  postgres:
    image: "postgres:15-alpine"
    port: 5432
  rabbitmq:
    image: "rabbitmq:3-management-alpine"
    ports:
      amqp: 5672
      management: 15672
  redpanda:
    image: "docker.redpanda.com/redpandadata/redpanda:v23.2.1"
    port: 9092

# Default Service Config
defaults:
  resources:
    limits:
      cpu: "500m"
      memory: "512Mi"
    requests:
      cpu: "100m"
      memory: "128Mi"
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 80
  pdb:
    enabled: true
    minAvailable: 1

# Microservices
services:
  auth:
    image: "microservice:latest"
    replicas: 2
    port: 8081
    env:
      DB_DSN: "postgres://{{ .Values.secrets.postgresUser }}:{{ .Values.secrets.postgresPassword }}@postgres:5432/microservices?sslmode=disable"
    resources:
      limits:
        cpu: "1000m"
        memory: "1Gi"
      requests:
        cpu: "200m"
        memory: "256Mi"
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 20
      targetCPUUtilizationPercentage: 70
    pdb:
      enabled: true
      minAvailable: 1

  payments:
    image: "microservice:latest"
    replicas: 2
    port: 8082
    env:
      DB_DSN: "postgres://{{ .Values.secrets.postgresUser }}:{{ .Values.secrets.postgresPassword }}@postgres:5432/payments?sslmode=disable"
      REDIS_ADDR: "redis:6379"
    resources:
      limits:
        cpu: "2000m"
        memory: "2Gi"
      requests:
        cpu: "500m"
        memory: "512Mi"
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 30
      targetCPUUtilizationPercentage: 60
    pdb:
      enabled: true
      minAvailable: 1

  ledger:
    image: "microservice:latest"
    replicas: 2
    port: 8083
    env:
      DB_DSN: "postgres://{{ .Values.secrets.postgresUser }}:{{ .Values.secrets.postgresPassword }}@postgres:5432/ledger?sslmode=disable"
    resources:
      limits:
        cpu: "1000m"
        memory: "1Gi"
      requests:
        cpu: "200m"
        memory: "256Mi"
    autoscaling:
      enabled: true
      minReplicas: 2
      maxReplicas: 10
      targetCPUUtilizationPercentage: 80
    pdb:
      enabled: true
      minAvailable: 1

  gateway:
    image: "microservice:latest"
    replicas: 2
    port: 8080
    env:
      REDIS_ADDR: "redis:6379"
      AUTH_SERVICE_URL: "http://auth:8081"
      PAYMENT_SERVICE_URL: "http://payments:8082"
      LEDGER_SERVICE_URL: "http://ledger:8083"
    resources:
      limits:
        cpu: "2000m"
        memory: "2Gi"
      requests:
        cpu: "500m"
        memory: "512Mi"
    autoscaling:
      enabled: true
      minReplicas: 3
      maxReplicas: 50
      targetCPUUtilizationPercentage: 60
    pdb:
      enabled: true
      minAvailable: 2

  notifications:
    image: "microservice:latest"
    replicas: 1
    port: 8084
    env:
      KAFKA_BROKERS: "redpanda:9092"
      KAFKA_TOPIC: "payment_events"
      KAFKA_GROUP_ID: "notification-service"
      RABBITMQ_URL: "amqp://{{ .Values.secrets.rabbitmqUser }}:{{ .Values.secrets.rabbitmqPassword }}@rabbitmq:5672/"
      REDIS_ADDR: "redis:6379"
      DATABASE_URL: "postgres://{{ .Values.secrets.postgresUser }}:{{ .Values.secrets.postgresPassword }}@postgres:5432/microservices?sslmode=disable"
    resources:
      limits:
        cpu: "500m"
        memory: "512Mi"
      requests:
        cpu: "100m"
        memory: "128Mi"
    autoscaling:
      enabled: true
      minReplicas: 1
      maxReplicas: 5
      targetCPUUtilizationPercentage: 80
    pdb:
      enabled: false

  fraud:
    image: "microservice:latest"
    replicas: 1
    port: 8081
    env:
      KAFKA_BROKERS: "redpanda:9092"
      RABBITMQ_URL: "amqp://{{ .Values.secrets.rabbitmqUser }}:{{ .Values.secrets.rabbitmqPassword }}@rabbitmq:5672/"
    resources:
      limits:
        cpu: "1000m"
        memory: "1Gi"
      requests:
        cpu: "200m"
        memory: "256Mi"
    autoscaling:
      enabled: true
      minReplicas: 1
      maxReplicas: 10
      targetCPUUtilizationPercentage: 80
    pdb:
      enabled: false

  reconciler:
    image: "microservice:latest"
    replicas: 1
    port: 8081
    env:
      PAYMENTS_DB_DSN: "postgres://{{ .Values.secrets.postgresUser }}:{{ .Values.secrets.postgresPassword }}@postgres:5432/payments?sslmode=disable"
      LEDGER_DB_DSN: "postgres://{{ .Values.secrets.postgresUser }}:{{ .Values.secrets.postgresPassword }}@postgres:5432/ledger?sslmode=disable"
    resources:
      limits:
        cpu: "500m"
        memory: "512Mi"
      requests:
        cpu: "100m"
        memory: "128Mi"
    autoscaling:
      enabled: false
      minReplicas: 1
      maxReplicas: 1
    pdb:
      enabled: false
